

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sdcflows.workflows.pepolar module &mdash; sdcflows 1.3.3 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/banner.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="sdcflows.workflows.phdiff module" href="sdcflows.workflows.phdiff.html" />
    <link rel="prev" title="sdcflows.workflows.outputs module" href="sdcflows.workflows.outputs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> sdcflows
          

          
          </a>

          
            
            
              <div class="version">
                1.3.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">Library API (application program interface)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sdcflows.interfaces.html">sdcflows.interfaces package</a></li>
<li class="toctree-l2"><a class="reference internal" href="sdcflows.viz.html">sdcflows.viz package</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="sdcflows.workflows.html">sdcflows.workflows package</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="sdcflows.workflows.html#automatic-selection-of-the-appropriate-susceptibility-distortion-correction-sdc-method">Automatic selection of the appropriate susceptibility-distortion correction (SDC) method</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="sdcflows.workflows.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.base.html">sdcflows.workflows.base module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.fmap.html">sdcflows.workflows.fmap module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.gre.html">sdcflows.workflows.gre module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.outputs.html">sdcflows.workflows.outputs module</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">sdcflows.workflows.pepolar module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.phdiff.html">sdcflows.workflows.phdiff module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.syn.html">sdcflows.workflows.syn module</a></li>
<li class="toctree-l4"><a class="reference internal" href="sdcflows.workflows.unwarp.html">sdcflows.workflows.unwarp module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changes.html">What’s new?</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">sdcflows</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../api.html">Library API (application program interface)</a> &raquo;</li>
        
          <li><a href="sdcflows.workflows.html">sdcflows.workflows package</a> &raquo;</li>
        
      <li>sdcflows.workflows.pepolar module</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/api/sdcflows.workflows.pepolar.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  


    
    



    <p class="scv-banner scv-sphinx_rtd_theme"><a href="../../master/api/sdcflows.workflows.pepolar.html"><b>Warning:</b> This document is for an old version of sdcflows. The main version is master.</a></p>
<div class="section" id="module-sdcflows.workflows.pepolar">
<span id="sdcflows-workflows-pepolar-module"></span><h1>sdcflows.workflows.pepolar module<a class="headerlink" href="#module-sdcflows.workflows.pepolar" title="Permalink to this headline">¶</a></h1>
<p>Datasets with multiple phase encoded directions.</p>
<div class="section" id="pepolar-techniques">
<span id="sdc-pepolar"></span><h2><abbr title="Phase Encoding POLARity">PEPOLAR</abbr> techniques<a class="headerlink" href="#pepolar-techniques" title="Permalink to this headline">¶</a></h2>
<p>This corresponds to <a class="reference external" href="https://bids-specification.readthedocs.io/en/stable/04-modality-specific-files/01-magnetic-resonance-imaging-data.html#case-4-multiple-phase-encoded-directions-pepolar">this section of the BIDS specification</a>.</p>
<dl class="function">
<dt id="sdcflows.workflows.pepolar.check_pes">
<code class="sig-prename descclassname">sdcflows.workflows.pepolar.</code><code class="sig-name descname">check_pes</code><span class="sig-paren">(</span><em class="sig-param">epi_fmaps</em>, <em class="sig-param">pe_dir</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sdcflows/workflows/pepolar.html#check_pes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sdcflows.workflows.pepolar.check_pes" title="Permalink to this definition">¶</a></dt>
<dd><p>Check whether there are images with matched PE.</p>
</dd></dl>

<dl class="function">
<dt id="sdcflows.workflows.pepolar.init_pepolar_unwarp_wf">
<code class="sig-prename descclassname">sdcflows.workflows.pepolar.</code><code class="sig-name descname">init_pepolar_unwarp_wf</code><span class="sig-paren">(</span><em class="sig-param">omp_nthreads=1</em>, <em class="sig-param">matched_pe=False</em>, <em class="sig-param">name='pepolar_unwarp_wf'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sdcflows/workflows/pepolar.html#init_pepolar_unwarp_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sdcflows.workflows.pepolar.init_pepolar_unwarp_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the PE-Polar field estimation workflow.</p>
<p>This workflow takes in a set of EPI files with opposite phase encoding
direction than the target file and calculates a displacements field
(in other words, an ANTs-compatible warp file).</p>
<p>This procedure works if there is only one <code class="docutils literal notranslate"><span class="pre">_epi</span></code> file is present
(as long as it has the opposite phase encoding direction to the target
file). The target file will be used to estimate the field distortion.
However, if there is another <code class="docutils literal notranslate"><span class="pre">_epi</span></code> file present with a matching
phase encoding direction to the target it will be used instead.</p>
<p>Currently, different phase encoding directions in the target file and the
<code class="docutils literal notranslate"><span class="pre">_epi</span></code> file(s) (for example, <code class="docutils literal notranslate"><span class="pre">i</span></code> and <code class="docutils literal notranslate"><span class="pre">j</span></code>) is not supported.</p>
<p>The warp field correcting for the distortions is estimated using AFNI’s
<code class="docutils literal notranslate"><span class="pre">3dQwarp</span></code>, with displacement estimation limited to the target file phase
encoding direction.</p>
<p>It also calculates a new mask for the input dataset that takes into
account the distortions.</p>
<dl>
<dt>Workflow Graph</dt><dd><div class="figure align-default">
<img alt="../_images/sdcflows-workflows-pepolar-1.png" src="../_images/sdcflows-workflows-pepolar-1.png" />
</div>
<p>(<a class="reference external" href="../api/sdcflows-workflows-pepolar-1.py">Source code</a>, <a class="reference external" href="../api/sdcflows-workflows-pepolar-1.png">png</a>, <a class="reference external" href="../api/sdcflows-workflows-pepolar-1.svg">svg</a>, <a class="reference external" href="../api/sdcflows-workflows-pepolar-1.pdf">pdf</a>)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matched_pe</strong> (<em>bool</em>) – Whether the input <code class="docutils literal notranslate"><span class="pre">fmaps_epi</span></code> will contain images with matched
PE blips or not. Please use <a class="reference internal" href="#sdcflows.workflows.pepolar.check_pes" title="sdcflows.workflows.pepolar.check_pes"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdcflows.workflows.pepolar.check_pes()</span></code></a>
to determine whether they exist or not.</p></li>
<li><p><strong>name</strong> (<em>str</em>) – Name for this workflow</p></li>
<li><p><strong>omp_nthreads</strong> (<em>int</em>) – Parallelize internal tasks across the number of CPUs given by this option.</p></li>
</ul>
</dd>
<dt class="field-even">Inputs</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>fmaps_epi</strong> (<em>list of tuple(pathlike, str)</em>) – The list of EPI images that will be used in PE-Polar correction, and
their corresponding <code class="docutils literal notranslate"><span class="pre">PhaseEncodingDirection</span></code> metadata.
The workflow will use the <code class="docutils literal notranslate"><span class="pre">epi_pe_dir</span></code> input to separate out those
EPI acquisitions with opposed PE blips and those with matched PE blips
(the latter could be none, and <code class="docutils literal notranslate"><span class="pre">in_reference_brain</span></code> would then be
used). The workflow raises a <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> when no images with
opposed PE blips are found.</p></li>
<li><p><strong>epi_pe_dir</strong> (<em>str</em>) – The baseline PE direction.</p></li>
<li><p><strong>in_reference</strong> (<em>pathlike</em>) – The baseline reference image (must correspond to <code class="docutils literal notranslate"><span class="pre">epi_pe_dir</span></code>).</p></li>
<li><p><strong>in_reference_brain</strong> (<em>pathlike</em>) – The reference image above, but skullstripped.</p></li>
<li><p><strong>in_mask</strong> (<em>pathlike</em>) – Not used, present only for consistency across fieldmap estimation
workflows.</p></li>
</ul>
</dd>
<dt class="field-odd">Outputs</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>out_reference</strong> (<em>pathlike</em>) – The <code class="docutils literal notranslate"><span class="pre">in_reference</span></code> after unwarping</p></li>
<li><p><strong>out_reference_brain</strong> (<em>pathlike</em>) – The <code class="docutils literal notranslate"><span class="pre">in_reference</span></code> after unwarping and skullstripping</p></li>
<li><p><strong>out_warp</strong> (<em>pathlike</em>) – The corresponding <abbr title="displacements field map">DFM</abbr> compatible with
ANTs.</p></li>
<li><p><strong>out_mask</strong> (<em>pathlike</em>) – Mask of the unwarped input file</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="sdcflows.workflows.pepolar.init_prepare_epi_wf">
<code class="sig-prename descclassname">sdcflows.workflows.pepolar.</code><code class="sig-name descname">init_prepare_epi_wf</code><span class="sig-paren">(</span><em class="sig-param">omp_nthreads</em>, <em class="sig-param">matched_pe=False</em>, <em class="sig-param">name='prepare_epi_wf'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/sdcflows/workflows/pepolar.html#init_prepare_epi_wf"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#sdcflows.workflows.pepolar.init_prepare_epi_wf" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare opposed-PE EPI images for PE-POLAR SDC.</p>
<p>This workflow takes in a set of EPI files and returns two 3D volumes with
matching and opposed PE directions, ready to be used in field distortion
estimation.</p>
<p>The procedure involves: estimating a robust template using FreeSurfer’s
<code class="docutils literal notranslate"><span class="pre">mri_robust_template</span></code>, bias field correction using ANTs <code class="docutils literal notranslate"><span class="pre">N4BiasFieldCorrection</span></code>
and AFNI <code class="docutils literal notranslate"><span class="pre">3dUnifize</span></code>, skullstripping using FSL BET and AFNI <code class="docutils literal notranslate"><span class="pre">3dAutomask</span></code>,
and rigid coregistration to the reference using ANTs.</p>
<dl>
<dt>Workflow Graph</dt><dd><div class="figure align-default">
<img alt="../_images/sdcflows-workflows-pepolar-2.png" src="../_images/sdcflows-workflows-pepolar-2.png" />
</div>
<p>(<a class="reference external" href="../api/sdcflows-workflows-pepolar-2.py">Source code</a>, <a class="reference external" href="../api/sdcflows-workflows-pepolar-2.png">png</a>, <a class="reference external" href="../api/sdcflows-workflows-pepolar-2.svg">svg</a>, <a class="reference external" href="../api/sdcflows-workflows-pepolar-2.pdf">pdf</a>)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>matched_pe</strong> (<em>bool</em>) – Whether the input <code class="docutils literal notranslate"><span class="pre">fmaps_epi</span></code> will contain images with matched
PE blips or not. Please use <a class="reference internal" href="#sdcflows.workflows.pepolar.check_pes" title="sdcflows.workflows.pepolar.check_pes"><code class="xref py py-func docutils literal notranslate"><span class="pre">sdcflows.workflows.pepolar.check_pes()</span></code></a>
to determine whether they exist or not.</p></li>
<li><p><strong>name</strong> (<em>str</em>) – Name for this workflow</p></li>
<li><p><strong>omp_nthreads</strong> (<em>int</em>) – Parallelize internal tasks across the number of CPUs given by this option.</p></li>
</ul>
</dd>
<dt class="field-even">Inputs</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>epi_pe</strong> (<em>str</em>) – Phase-encoding direction of the EPI image to be corrected.</p></li>
<li><p><strong>maps_pe</strong> (<em>list of tuple(pathlike, str)</em>) – list of 3D or 4D NIfTI images</p></li>
<li><p><strong>ref_brain</strong> – coregistration reference (skullstripped and bias field corrected)</p></li>
</ul>
</dd>
<dt class="field-odd">Outputs</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>opposed_pe</strong> (<em>pathlike</em>) – single 3D NIfTI file</p></li>
<li><p><strong>matched_pe</strong> (<em>pathlike</em>) – single 3D NIfTI file</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sdcflows.workflows.phdiff.html" class="btn btn-neutral float-right" title="sdcflows.workflows.phdiff module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="sdcflows.workflows.outputs.html" class="btn btn-neutral float-left" title="sdcflows.workflows.outputs module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The NiPreps developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: 1.2.1
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Tags</dt>
            <dd><a href="../../1.0.0/api/sdcflows.workflows.pepolar.html">1.0.0</a></dd>
            <dd><a href="../../1.0.0rc1/api/sdcflows.workflows.pepolar.html">1.0.0rc1</a></dd>
            <dd><a href="../../1.0.1/api/sdcflows.workflows.pepolar.html">1.0.1</a></dd>
            <dd><a href="../../1.0.2/api/sdcflows.workflows.pepolar.html">1.0.2</a></dd>
            <dd><a href="../../1.0.3/api/sdcflows.workflows.pepolar.html">1.0.3</a></dd>
            <dd><a href="../../1.0.4/api/sdcflows.workflows.pepolar.html">1.0.4</a></dd>
            <dd><a href="../../1.0.5/api/sdcflows.workflows.pepolar.html">1.0.5</a></dd>
            <dd><a href="../../1.0.6/api/sdcflows.workflows.pepolar.html">1.0.6</a></dd>
            <dd><a href="../../1.1.0/api/sdcflows.workflows.pepolar.html">1.1.0</a></dd>
            <dd><a href="../../1.2.0/api/sdcflows.workflows.pepolar.html">1.2.0</a></dd>
            <dd><a href="sdcflows.workflows.pepolar.html">1.2.1</a></dd>
            <dd><a href="../../1.2.2/api/sdcflows.workflows.pepolar.html">1.2.2</a></dd>
            <dd><a href="../../1.2.3/api/sdcflows.workflows.pepolar.html">1.2.3</a></dd>
            <dd><a href="../../1.3.0/api/sdcflows.workflows.pepolar.html">1.3.0</a></dd>
            <dd><a href="../../1.3.1/api/sdcflows.workflows.pepolar.html">1.3.1</a></dd>
            <dd><a href="../../1.3.2/api/sdcflows.workflows.pepolar.html">1.3.2</a></dd>
            <dd><a href="../../1.3.3/api/sdcflows.workflows.pepolar.html">1.3.3</a></dd>
        </dl>
        <dl>
            <dt>Branches</dt>
            <dd><a href="../../maint_1.0.x/api/sdcflows.workflows.pepolar.html">maint/1.0.x</a></dd>
            <dd><a href="../../maint_1.2.x/api/sdcflows.workflows.pepolar.html">maint/1.2.x</a></dd>
            <dd><a href="../../maint_1.3.x/api/sdcflows.workflows.pepolar.html">maint/1.3.x</a></dd>
            <dd><a href="../../master/api/sdcflows.workflows.pepolar.html">master</a></dd>
        </dl>
    </div>
</div>


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>